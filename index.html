<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gurjot's Games</title>
  <meta name="description" content="A tiny arcade hub with multiple games. Click a tile to play." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="brand">ðŸŽ® Gurjot's Games</div>
    <div class="hint">Click a game to play â€¢ Add more by copying a folder in <code>/games</code></div>
  </header>
  <main>
    <div class="filters"></div>
    <section class="grid"></section>
  </main>
  <footer>Static, framework-free. Host anywhere (GitHub Pages ready).</footer>
  <script>
    const savedFilters = JSON.parse(localStorage.getItem('hub:filters') || '[]');

    fetch('games.json')
      .then(r => r.json())
      .then(games => {
        const grid = document.querySelector('.grid');
        const filterBar = document.querySelector('.filters');
        if (!grid || !filterBar) return;
        grid.innerHTML = '';

        // Collect unique tags
        const tagSet = new Set();
        for (const g of games) {
          const tags = g.tags || (g.badge ? [g.badge] : []);
          tags.forEach(t => tagSet.add(t));
        }

        // Render filter chips
        for (const tag of Array.from(tagSet).sort()) {
          const chip = document.createElement('button');
          chip.type = 'button';
          chip.className = 'filter-chip';
          chip.textContent = tag;
          chip.dataset.tag = tag;
          if (savedFilters.includes(tag)) chip.classList.add('active');
          chip.addEventListener('click', () => {
            chip.classList.toggle('active');
            updateFilters();
          });
          filterBar.appendChild(chip);
        }

        // Render game cards
        for (const g of games) {
          const a = document.createElement('a');
          a.className = 'card';
          a.href = g.path;
          a.setAttribute('aria-label', `Play ${g.name}`);

          const tags = g.tags || (g.badge ? [g.badge] : []);
          a.dataset.tags = tags.join(',');

          const thumb = document.createElement('div');
          thumb.className = 'thumb';
          if (g.thumb) thumb.style.backgroundImage = `url(${g.thumb})`;
          a.appendChild(thumb);

          const h3 = document.createElement('h3');
          h3.textContent = g.name;
          a.appendChild(h3);

          if (tags.length) {
            const tagWrap = document.createElement('div');
            tagWrap.className = 'tags';
            for (const t of tags) {
              const span = document.createElement('span');
              span.className = 'tag';
              span.textContent = t;
              tagWrap.appendChild(span);
            }
            a.appendChild(tagWrap);
          }

          const p = document.createElement('p');
          p.textContent = g.description;
          a.appendChild(p);

          const best = localStorage.getItem(`highscore:${g.id}`) ??
                       localStorage.getItem(`besttime:${g.id}`);
          if (best) {
            const bestDiv = document.createElement('div');
            bestDiv.className = 'best';
            bestDiv.textContent = `Best: ${best}`;
            a.appendChild(bestDiv);
          }

          const play = document.createElement('div');
          play.className = 'play';
          play.textContent = 'Play â†’';
          a.appendChild(play);

          grid.appendChild(a);
        }

        function updateFilters() {
          const active = Array.from(filterBar.querySelectorAll('.filter-chip.active'))
            .map(el => el.dataset.tag);
          localStorage.setItem('hub:filters', JSON.stringify(active));
          for (const card of grid.querySelectorAll('.card')) {
            const cardTags = card.dataset.tags ? card.dataset.tags.split(',') : [];
            const match = active.length === 0 || active.some(t => cardTags.includes(t));
            card.style.display = match ? '' : 'none';
          }
        }

        updateFilters();
      })
      .catch(err => {
        console.warn('Failed to load games.json', err);
      });
  </script>
</body>
</html>
